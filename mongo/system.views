{ "_id" : "sanasur.vProductos", "viewOn" : "productos", "pipeline" : [ { "$lookup" : { "from" : "productos", "localField" : "parent", "foreignField" : "_id", "as" : "parent" } }, { "$unwind" : { "path" : "$parent" } } ] }
{ "_id" : "sanasur.vMedisurPlanes", "viewOn" : "medisurPlanes", "pipeline" : [ { "$facet" : { "prestaciones" : [ { "$unwind" : { "path" : "$prestaciones" } }, { "$lookup" : { "from" : "vProductos", "localField" : "prestaciones.producto", "foreignField" : "_id", "as" : "prestaciones.producto" } }, { "$unwind" : { "path" : "$prestaciones.producto" } }, { "$replaceRoot" : { "newRoot" : "$prestaciones" } } ], "tmpRoot" : [ { "$project" : { "prestaciones" : 0 } } ] } }, { "$project" : { "tmpRoot" : { "$mergeObjects" : [ { "$arrayElemAt" : [ "$tmpRoot", 0 ] }, { "prestaciones" : "$prestaciones" } ] } } }, { "$replaceRoot" : { "newRoot" : "$tmpRoot" } } ] }
{ "_id" : "sanasur.vMedisurContratos", "viewOn" : "medisurContratos", "pipeline" : [ { "$unwind" : { "path" : "$eventos", "includeArrayIndex" : "tmpI", "preserveNullAndEmptyArrays" : true } }, { "$unwind" : { "path" : "$eventos.prestaciones", "preserveNullAndEmptyArrays" : true } }, { "$lookup" : { "from" : "vProductos", "localField" : "eventos.prestaciones.producto", "foreignField" : "_id", "as" : "eventos.prestaciones.producto" } }, { "$set" : { "eventos.prestaciones" : { "$cond" : { "if" : { "$eq" : [ "$eventos.prestaciones.producto", [ ] ] }, "then" : "$$REMOVE", "else" : { "$mergeObjects" : [ "$eventos.prestaciones", { "producto" : { "$arrayElemAt" : [ "$eventos.prestaciones.producto", 0 ] } } ] } } } } }, { "$group" : { "_id" : { "_id" : "$_id", "tmpI" : "$tmpI" }, "prestaciones" : { "$push" : "$eventos.prestaciones" }, "eventos" : { "$first" : "$eventos" } } }, { "$set" : { "_id" : "$_id._id", "eventos.prestaciones" : "$prestaciones" } }, { "$group" : { "_id" : "$_id", "eventos" : { "$push" : "$eventos" } } }, { "$project" : { "eventos" : { "$cond" : { "if" : { "$eq" : [ "$eventos", [ { "prestaciones" : [ ] } ] ] }, "then" : "$$REMOVE", "else" : "$eventos" } } } }, { "$lookup" : { "from" : "medisurContratos", "localField" : "_id", "foreignField" : "_id", "as" : "tmpRoot" } }, { "$replaceRoot" : { "newRoot" : { "$mergeObjects" : [ { "$arrayElemAt" : [ "$tmpRoot", 0 ] }, "$$ROOT" ] } } }, { "$project" : { "tmpRoot" : 0 } }, { "$lookup" : { "from" : "facturas", "localField" : "_id", "foreignField" : "contrato", "as" : "pagos" } } ] }
{ "_id" : "sanasur.vAuthUsuarios", "viewOn" : "authUsuarios", "pipeline" : [ { "$lookup" : { "from" : "authPerfiles", "localField" : "perfiles", "foreignField" : "_id", "as" : "perfiles" } } ] }
